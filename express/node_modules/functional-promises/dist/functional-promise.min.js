(function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.FP=b():a.FP=b()})("undefined"==typeof self?this:self,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=2)}([function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});class c extends Error{constructor(c,d){"object"==typeof c&&(d=c,c.message&&(c=c.message)),super(c),"object"==typeof d&&Object.getOwnPropertyNames(d).forEach(b=>{this[b]=d[b]}),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}}b.FunctionalError=c;b.FunctionalUserError=class extends c{};b.FPUnexpectedError=class extends c{};b.FPInputError=class extends c{};b.FPSoftError=class extends c{};b.FPTimeout=class extends c{}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});const c={isPromiseLike(b){return!!(b&&"function"==typeof b.then)},isFunction(b){return"function"==typeof b},isEnumerable(b){return b&&Array.isArray(b)||"function"==typeof b[Symbol.iterator]},flatten(b){if(!Array.isArray(b))throw new Error("Method `flatten` requires valid array parameter");return b.reduce((d,a)=>d.concat(Array.isArray(a)?c.flatten(a):[a]),[])}};b.default=c},function(a,b,c){"use strict";function d(b){return b&&b.__esModule?b:{default:b}}function e(b){if(!(this instanceof e))return new e(b);if(1!==arguments.length)throw new Error("FunctionalPromises constructor only accepts 1 callback argument");this._FP={errors:{limit:0,count:0},promise:new Promise(b),concurrencyLimit:4}}Object.defineProperty(b,"__esModule",{value:!0}),b.default=e;var f=c(0),g=c(1),h=d(g),i=c(3),j=d(i),k=c(4),l=d(k),m=c(5),n=c(6),o=d(n),p=c(7),q=d(p);const{isFunction:r,flatten:s}=h.default,{map:t,find:u,findIndex:v,filter:w,flatMap:x,reduce:y}=(0,l.default)(e),{all:z,reject:A,delay:B,_delay:C}=(0,q.default)(e),{tapIf:D,thenIf:E,_thenIf:F}=(0,o.default)(e),{chain:G,chainEnd:H}=(0,j.default)(e);e.prototype.all=z,e.prototype.map=t,e.prototype.find=u,e.prototype.findIndex=v,e.prototype.filter=w,e.prototype.flatMap=x,e.prototype.reduce=y,e.prototype.listen=m.listen,e.prototype.tapIf=D,e.prototype.thenIf=E,e.prototype._thenIf=F,e.prototype.delay=B,e.prototype._delay=C,e.prototype.reject=A,e.all=e.prototype.all,e.thenIf=e.prototype._thenIf,e.delay=b=>e.resolve().delay(b),e.silent=b=>e.resolve().silent(b),e.chain=G,e.prototype.chainEnd=H,e.reject=e.prototype.reject,e.resolve=function(d){return new e((a,b)=>d&&r(d.then)?d.then(a).catch(b):void a(d))},e.promisify=function(f){return(...a)=>new e((e,c)=>f.call(this,...a,(d,a)=>d?c(d):e(a)))},e.promisifyAll=function(c){if(!c||!Object.getPrototypeOf(c))throw new Error("Invalid Argument obj in promisifyAll(obj)");return Object.getOwnPropertyNames(c).filter(a=>"function"==typeof c[a]).reduce((c,a)=>(/Sync/.test(a)||c[`${a}Async`]||(c[`${a}Async`]=e.promisify(c[`${a}`])),c),c)},e.unpack=function(){let f,g,d=new e((a,b)=>{f=a,g=b});return{promise:d,resolve:f,reject:g}},e.prototype.addStep=function(c,a){return this.steps&&this.steps.push([c,this,a]),this},e.prototype.concurrency=function(b=1/0){return this.steps?this.addStep("concurrency",[...arguments]):(this._FP.concurrencyLimit=b,this)},e.prototype.quiet=function(b=1/0){return this.steps?this.addStep("quiet",[...arguments]):(this._FP.errors={count:0,limit:b},this)},e.prototype.silent=e.prototype.quiet,e.prototype.get=function(...c){return this.steps?this.addStep("get",[...arguments]):(c=s(c),this.then(d=>"object"==typeof d?1===c.length?d[c[0]]:c.reduce((b,a)=>(b[a]=d[a],b),{}):d))},e.prototype.set=function(d,a){return this.steps?this.addStep("set",[...arguments]):this.then(b=>("object"==typeof b&&(b[d]=a),b))},e.prototype.catch=function(c){if(this.steps)return this.addStep("catch",[...arguments]);if(2===arguments.length)return this.catchIf(...arguments);if(!r(c))throw new f.FunctionalError("Invalid fn argument for `.catch(fn)`. Must be a function. Currently: "+typeof c);return e.resolve(this._FP.promise.catch(a=>c(a)))},e.prototype.catchIf=function(d,a){if(this.steps)return this.addStep("catchIf",[...arguments]);if(!r(a))throw new f.FunctionalError("Invalid fn argument for `.catchIf(condition, fn)`. Must be a function. Currently: "+typeof a);return e.resolve(this._FP.promise.catch(b=>{if(d&&b instanceof d)return a(b);throw b}))},e.prototype.then=function(b){if(this.steps)return this.addStep("then",[...arguments]);if(!r(b))throw new f.FunctionalError("Invalid fn argument for `.then(fn)`. Must be a function. Currently: "+typeof b);return e.resolve(this._FP.promise.then(b))},e.prototype.tap=function(c){if(this.steps)return this.addStep("tap",[...arguments]);if(!r(c))throw new f.FunctionalError("Invalid fn argument for `.tap(fn)`. Must be a function. Currently: "+typeof c);return e.resolve(this._FP.promise.then(a=>c(a)?a:a))}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(h){return{chain:function(){const a=h.resolve();return a.steps=[],a},chainEnd:function(){return a=>{if(!this.steps||0>=this.steps.length)throw new g.FPInputError("No steps defined between .chain() & .chainEnd()");let i=0,{promise:j,resolve:b,reject:e}=h.unpack();for(;i<this.steps.length;){const[c,,a]=this.steps[i];j=j[c](...a),i++}return b(a),j}}}};var g=c(0)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(o){function d(a,d){return this.steps?this.addStep("_find",[...arguments]):("function"==typeof a&&(d=a,a=this._FP.promise),o.resolve(a).filter(d).then(b=>null==b[0]?{item:void 0,index:-1}:{item:b[0],index:b.indexOf(b[0])}))}function e(f,e,i){return this.steps?this.addStep("reduce",[...arguments]):("function"==typeof f?(i=e,e=f,f=this._FP?this._FP.promise:this):f=o.resolve(f,this),new o((c,a)=>f.then(d=>{const j=d[Symbol.iterator]();let f=0;const k=g=>{const b=j.next();return b.done?c(g):void Promise.all([g,b.value]).then(([c,a])=>k(e(c,a,f++))).catch(a)};k(i)})))}return{map:function(v,p){if(this.steps)return this.addStep("map",[...arguments]);1===arguments.length&&this&&this._FP&&(p=v,v=this&&this._FP&&this._FP.promise);let w=!1;const a=Math.max(1,Math.min(this&&this._FP&&this._FP.concurrencyLimit||1,4)),c=this&&this._FP&&this._FP.promise?this._FP.promise:Promise.resolve(v);let f=0,s=[],h=0;const x=[],j=new Set,k=()=>j.size>=a,l=()=>s.length>this._FP.errors.limit||h>=v.length||w,m=c=>a=>(j.delete(c),x[c]=a,a);return o.resolve(new Promise((d,b)=>{const e=a=>w?null:void(w=!0,d(a)),g=c=>w?null:void(w=!0,b(c));c.then(c=>{if(v=[...c],!u(c))return b(new t.FPInputError("Invalid input data passed into FP.map()"));const d=()=>{let b=null;return s.length>this._FP.errors.limit&&(b=g),l()&&(b=e),!!b&&(!!Promise.all(x).then(()=>b(x))||!0)},i=b=>{if(!w)return d()||x[h]||n(h),b},n=d=>w?null:(h++,k())?setTimeout(()=>n(d),0):x[d]?x[d]:(j.add(d),x[d]=Promise.resolve(v[d]).then(a=>p(a,d,v)).then(a=>m(d)(a)).then(i).catch(a=>{if(this._FP.errors.count++,s.push(a),s.length>this._FP.errors.limit){const b=1===s.length?a:new t.FunctionalError(`Error Limit ${this._FP.errors.limit} Exceeded.
                idx=${d} errCnt=${this._FP.errors.count}`,{errors:s,results:x,ctx:this});Promise.resolve(m(d)(a)).then(()=>g(b))}else return Promise.resolve().then(()=>m(d)(a)).then(i)}),x[d]);for(;f<a&&f<v.length;)n(f++)})}))},find:function(b){return d.call(this,b).then(({item:b})=>b)},findIndex:function(b){return d.call(this,b).then(({index:b})=>b)},filter:function(c,d){return this.steps?this.addStep("filter",[...arguments]):("function"==typeof c&&(d=c,c=this._FP.promise),e.call(this,c,(e,a)=>Promise.resolve(d(a)).then(c=>c?e.concat([a]):e),[]))},flatMap:function(a,d){return this.steps?this.addStep("flatMap",[...arguments]):("function"==typeof a&&(d=a,a=this._FP.promise),o.resolve(a).map(d).reduce((c,a)=>c.concat(...a),[]))},reduce:e}};var d=c(1),e=function(b){return b&&b.__esModule?b:{default:b}}(d),t=c(0);const{isEnumerable:u}=e.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.listen=void 0;var d=c(0);b.listen=function(e,...a){if("string"==typeof a&&(a=[a]),!e[e.addEventListener?"addEventListener":"on"])throw new d.FPInputError("Valid EventEmitter required.");const f=this.chainEnd();return this._FP.destroy=()=>this._FP.destroyHandles.map(b=>b()||!0).filter(b=>b).length,this._FP.destroyHandles=a.map(a=>(e[e.addEventListener?"addEventListener":"on"](a,f),()=>e[e.removeEventListener?"removeEventListener":"off"](a,f))),this}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(g){function h(a=b=>b,b=b=>b,c=()=>null,d=!1){return e=>g.resolve(a(e)).then(d=>d?b(e):c(e)).then(b=>d?e:b)}return{tapIf:function(b,g,i){return this.steps?this.addStep("tapIf",[...arguments]):(1===arguments.length&&(g=b,b=b=>b),f(this)?this.then(a=>h(b,g,i,!0)(a)):h(b,g,i,!0))},thenIf:function(b,g,i){return this.steps?this.addStep("thenIf",[...arguments]):(1===arguments.length&&(g=b,b=b=>b),f(this)?this.then(a=>h(b,g,i)(a)):h(b,g,i))},_thenIf:h}};var d=c(1),e=function(b){return b&&b.__esModule?b:{default:b}}(d);const{isPromiseLike:f}=e.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(e){function a(d){const g=Object.getOwnPropertyNames(d),a=g.map(a=>d[a]);return Promise.all(a).then(b=>b.reduce((b,a,c)=>{var d;const h=g[c];return Object.assign((d={},d[h]=a,d),b)},{}))}function f(f){if(!Number.isInteger(f))throw new d.FPInputError("FP.delay(millisec) requires a numeric arg.");return b=>new e(c=>{setTimeout(()=>c(b),f)})}return{all:function(b){return e.resolve(Array.isArray(b)?Promise.all(b):a(b))},reject:function(b){if(b instanceof Error)return this&&(this._error=b),Promise.reject(b);throw new Error(`Reject only accepts a new instance of Error!`)},delay:function(a){return this.steps?this.addStep("delay",[...arguments]):this&&this._FP?e.resolve(this.then(f(a))):f(a)()},_delay:f}};var d=c(0)}])});